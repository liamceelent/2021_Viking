<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">




  <body id ="overall">

    {% include 'nav.html' %}

    <div class = "map_wrapper">
      <div class = "map_text">
        <h1> sleect a period </h1>
        <form method="POST">
        <input type="range" min="1" max="5" value="3" id="period">
        </form>
        <button>view comments</button>
      </div>

      <div class="clan_wrapper">
      {% for clans in clan %}

        <div class = "clans">
        <h1 style="color:{{ clans.color }};">{{clans.name}}</h1>

        </div>

      {% endfor %}
      </div>
    </div>
    <div id="geochart-colors"></div>

    </body>

  </html>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">

    google.charts.load('current', {
      'packages':['geochart'], // google plug ins
      'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
    });
    google.charts.setOnLoadCallback(drawRegionsMap);

    function drawRegionsMap(d) {
      if(d){
        var data = d
        console.log(data)
      }

      else {
        console.log('{{places["location"]}}')
        var data = google.visualization.arrayToDataTable([
          ['Country',   'Faction',],

           {% for i in range(places["location"]|length) %} // this is getting all coutnris and the numebr beside it
             ['{{ places["location"][i] }}', {{ places["faction"][i]  }}], // google chart of the lists i sent through
           {% endfor %}

          ]);
          console.log(data)
      }


      var options = {
        region: '150', // euro
        colorAxis: {colors: ['white', 'blue', '3009A0', '66FCF1', '45A29E', 'C5C6C7']}, // chart colors
        backgroundColor: '#0B0C10',
        datalessRegionColor: 'aqua',
        defaultColor: 'aqua',
        legend:'none',
      };

      var chart = new google.visualization.GeoChart(document.getElementById('geochart-colors'));

      google.visualization.events.addListener(chart, 'select', function () {
        var selection = chart.getSelection();
       item = selection[0]
       a = item.row
       console.log(a);

      });


      chart.draw(data, options);
    };

    // NOT GOOGLE
    document.querySelectorAll(".map_text button")
      .forEach(element => element.addEventListener("click", change));

    function change() {
      var x = document.getElementById("period").value;
        console.log("yo");

        fetch('/maps', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify({
                         period: x,
                     })
                 })

                 .then(response => response.json())
                      .then(data => {
                          console.log('Success:', data["faction"], data["location"]);

                          lst = [["russia", 1], ['a', 2]]
                          var map = google.visualization.arrayToDataTable([
                            ['Country',   'Faction',],
                            lst
                            ]);

                          drawRegionsMap(map)

                      });


      }
  </script>

</html>
