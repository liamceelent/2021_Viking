<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
   <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
   <script type="text/javascript">

     google.charts.load('current', {
       'packages':['geochart'], // google plug ins
       'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
     });
     google.charts.setOnLoadCallback(drawRegionsMap);

     function drawRegionsMap() {
       var data = google.visualization.arrayToDataTable([
         ['Country',   'Faction',],

          {% for i in range(places["location"]|length) %} // this is getting all coutnris and the numebr beside it
            ['{{ places["location"][i] }}', {{ places["faction"][i]  }}], // google chart of the lists i sent through
          {% endfor %}

         ]);

       var options = {
         region: '150', // euro
         colorAxis: {colors: ['white', 'blue', '3009A0', '66FCF1', '45A29E', 'C5C6C7']}, // chart colors
         backgroundColor: '#0B0C10',
         datalessRegionColor: 'aqua',
         defaultColor: 'aqua',
         legend:'none',
       };

       var chart = new google.visualization.GeoChart(document.getElementById('geochart-colors'));

       google.visualization.events.addListener(chart, 'select', function () {
         var selection = chart.getSelection();
        item = selection[0]
        a = item.row
        console.log(a);
        window.location.replace(a);

       });


       chart.draw(data, options);
     };
   </script>



  <body id ="overall">

    {% include 'nav.html' %}

    <div class = "map_wrapper">
      <div class = "map_text">
        <h1> sleect a period </h1>
        <form method="POST">
        <input type="range" min="1" max="5" value="3" id="period">
        </form>
        <button>view comments</button>
      </div>

      <div class="clan_wrapper">
      {% for clans in clan %}

        <div class = "clans">
        <h1 style="color:{{ clans.color }};">{{clans.name}}</h1>

        </div>

      {% endfor %}
      </div>
    </div>
    <div id="geochart-colors"></div>

    </body>

  </html>
  <script>

  document.querySelectorAll(".map_text button")
    .forEach(element => element.addEventListener("click", change));

  function change() {
    var x = document.getElementById("period").value;
      console.log("yo");

      fetch('/maps', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify({
                       period: x,
                   })
               })

               .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        event.target.parentElement.querySelector("p").innerHTML = data + "<span>&#10084;</span>";
                        switch (event.target.checked) {
                            case (true):
                                color = "#0000004d";
                                break;
                            case (false):
                                color = "#2d539e"
                                break;
                            default:
                                color = "#2d539e";

                        }
                        event.target.parentElement.querySelector("span").style.color = color;

                    });
    }



  </script>

</html>
